# Quiz Game Template

## Purpose
A full 3D trivia/quiz game rendered in Three.js with an immersive 3D environment (game show stage, floating question panels). Users answer multiple-choice questions displayed on 3D panels in a WebGL scene with dramatic lighting shifts for correct/incorrect feedback. Scene code is generated by the Claude Agent SDK based on the game configuration.

## User Stories

### P1 (Critical)
- US1: As a player, I want to see a question displayed on a 3D panel with multiple answer options as 3D buttons so that I can make my choice
- US2: As a player, I want immediate 3D visual feedback (green glow vs red flash with camera shake) on whether my answer was correct
- US3: As a campaign creator, I want to configure questions, answers, and winning threshold so that I can create custom quizzes

### P2 (Important)
- US4: As a player, I want a 3D timer (countdown ring or hourglass model) for each question so that the game has urgency
- US5: As a player, I want to see my progress (question X of Y) so that I know how much is left
- US6: As a campaign creator, I want to set different prizes for different score ranges so that partial success is rewarded

### P3 (Nice to Have)
- US7: As a player, I want explanations for wrong answers so that I learn something
- US8: As a campaign creator, I want to randomize question order so that the quiz is harder to share answers

## Requirements

### 3D Quiz Environment
- REQ1: THREE.Scene with a 3D stage/environment model (game show set, abstract space, or branded environment)
- REQ2: Question displayed on a 3D panel/screen mesh with dynamically generated text texture (canvas-to-texture)
- REQ3: Answer options rendered as 3D button/panel meshes arranged in the scene
- REQ4: PerspectiveCamera with smooth transitions (fly-through) between question scenes
- REQ5: Dynamic lighting that shifts based on correct/incorrect (green spotlight vs red flash)

### Quiz Mechanics
- REQ6: Display one question at a time with 2-4 answer options as 3D panels
- REQ7: Raycaster-based answer selection - tap/click on a 3D answer panel to submit
- REQ8: Correct/incorrect feedback before advancing to next question
- REQ9: Optional 3D timer per question (countdown ring mesh or hourglass model, configurable 10-60 seconds)
- REQ10: Final score calculated as correct answers / total questions

### Visual Feedback in 3D
- REQ11: Correct answer: 3D panel glows green (emissive material), particle celebration, camera zooms in
- REQ12: Wrong answer: 3D panel flashes red, camera shake effect, spotlight reveals correct answer
- REQ13: Timer: 3D circular countdown ring mesh that depletes, or hourglass model with particle sand
- REQ14: Question transitions: camera fly-through between question scenes with smooth easing

### Post-Processing
- REQ15: Bloom on correct answer panels for luminous feedback
- REQ16: Color grading shift for win (warm tones) vs lose (cool tones) on results screen
- REQ17: Depth of field during transitions to focus on incoming question

### Configuration Schema
```typescript
interface QuizConfig {
  questions: QuizQuestion[];
  time_per_question_sec?: number;
  passing_score: number;
  show_correct_answer: boolean;
  randomize_questions: boolean;
  randomize_answers: boolean;
  prize_tiers: PrizeTier[];
  scene: SceneConfig;
  camera: CameraConfig;
  lighting: LightingConfig;
  post_processing: PostProcessingConfig;
}

interface QuizQuestion {
  question_text: string;
  question_image_url?: string;
  answers: QuizAnswer[];
  explanation?: string;
}

interface QuizAnswer {
  text: string;
  is_correct: boolean;
}

interface PrizeTier {
  min_score: number;
  max_score: number;
  prize_label: string;
  prize_code?: string;
  is_winner: boolean;
}

interface SceneConfig {
  background_type: 'color' | 'environment_map' | 'skybox';
  background_color?: string;
  environment_map_slot?: string;
}

interface CameraConfig {
  fov: number;
  position: { x: number; y: number; z: number };
  look_at: { x: number; y: number; z: number };
  transition_duration_ms: number;
  shake_intensity: number;
}

interface LightingConfig {
  ambient: { color: string; intensity: number };
  spotlights: SpotlightConfig[];
  correct_color: string;
  wrong_color: string;
}

interface SpotlightConfig {
  color: string;
  intensity: number;
  position: { x: number; y: number; z: number };
  target: { x: number; y: number; z: number };
  angle: number;
  penumbra: number;
}

interface PostProcessingConfig {
  bloom_enabled: boolean;
  bloom_strength: number;
  bloom_threshold: number;
  color_grading_enabled: boolean;
  dof_enabled: boolean;
}
```

### Asset Slots
| Slot ID | Type | Required | Description |
|---------|------|----------|-------------|
| stage_model | model_3d (GLB) | No | 3D stage/environment model (fallback: procedural planes) |
| answer_panel_model | model_3d (GLB) | No | 3D answer button/panel model |
| timer_model | model_3d (GLB) | No | 3D hourglass or countdown model |
| logo_model_3d | model_3d (GLB) | No | 3D brand logo placed in scene |
| environment_map | texture (HDR) | No | HDRI environment map for reflections |
| background_image | image | No | 2D fallback background |
| logo | image | No | 2D brand logo overlay |
| bgm_track | audio | No | Background music |
| correct_sound | audio | No | Sound for correct answer |
| wrong_sound | audio | No | Sound for wrong answer |
| tick_sound | audio | No | Timer tick sound |
| win_sound | audio | Yes | Final win sound |
| lose_sound | audio | No | Final lose sound |

### Progress & Scoring
- REQ18: Show progress indicator as HUD overlay: "Question 3 of 10"
- REQ19: Optionally show running score during quiz
- REQ20: Final results screen shows: score, time taken, prize won (HTML overlay on 3D scene)

### Responsive Behavior
- REQ21: WebGL canvas fills viewport, renderer resizes on window change
- REQ22: 3D answer panels reposition for portrait vs landscape
- REQ23: Touch-friendly: raycasted tap targets on 3D panels, 2D overlay buttons minimum 44px
- REQ24: Timer visible without scrolling (rendered in 3D scene or as HUD overlay)

### Outcome Handling
- REQ25: Emit `gameComplete` event with results
- REQ26: Event payload: `{ score: number, totalQuestions: number, timeMs: number, prizeTier: PrizeTier }`
- REQ27: Display results screen with score, prize, and CTA

## Technical Implementation
- Framework: Three.js (WebGL renderer) with scene code generated by Claude Agent SDK
- Text Rendering: CanvasTexture for dynamic question/answer text mapped onto 3D plane meshes
- Scene: THREE.Scene with stage model (GLTFLoader) or procedural geometry
- Interaction: THREE.Raycaster for answer selection in 3D space
- Animation: GSAP for camera transitions, panel animations, and shake effects
- Materials: THREE.MeshStandardMaterial with PBR properties, emissive for feedback glow
- Post-Processing: EffectComposer with UnrealBloomPass, ColorCorrectionShader, BokehPass
- Timer: Custom ring geometry with shader-based depletion animation, or loaded GLB timer model
- Audio: THREE.Audio for ambient and feedback sounds
- State: Simple state machine (showing_question, showing_feedback, transitioning, results)
- Asset Loading: GLTFLoader for GLB models, TextureLoader for images, RGBELoader for HDR

## Performance
- Target: 60fps on mid-range mobile devices
- Dynamic text textures cached per question to avoid re-rendering
- Compressed textures (KTX2) for GPU-optimized delivery
- Geometry reuse for answer panels (InstancedMesh or shared geometry)
- Dispose textures and geometries between question transitions

## Dependencies
- Depends on: Template System (manifest, config injection, asset slots), Three.js runtime, Claude Agent SDK for code generation
- Required by: bundle_game_template skill when template_id = "quiz"

## Success Criteria
- [ ] 3D quiz environment renders with stage model and answer panels
- [ ] Questions display correctly via canvas-to-texture on 3D panels
- [ ] Raycaster answer selection works reliably on touch and pointer devices
- [ ] Correct/wrong feedback is immediate with 3D effects (glow, shake, particles)
- [ ] Camera transitions between questions are smooth
- [ ] 3D timer counts down accurately and triggers timeout
- [ ] Score calculation matches expected results
- [ ] Prize tier assignment works based on score ranges
- [ ] Dynamic lighting shifts for correct (green) and wrong (red) are visible
- [ ] Bloom post-processing activates on correct answers
- [ ] Works offline after initial load
- [ ] Accessible: keyboard navigation for answer selection, screen reader compatible HUD
