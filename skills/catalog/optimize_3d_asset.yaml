# Skill Descriptor: optimize_3d_asset
# Optimizes existing 3D models for web/mobile/game use

skill_id: optimize_3d_asset
version: "1.0.0"
title: Optimize 3D Asset
description: |
  Optimizes existing 3D models for different platforms and use cases.
  Supports polygon reduction, texture compression, LOD generation,
  and various compression methods (Draco, Meshopt).
  Provides detailed metrics comparing original and optimized models.

tags:
  - 3d
  - optimization
  - compression
  - model
  - asset
  - game
  - web

input_schema:
  type: object
  required:
    - model_uri
    - constraints
  properties:
    model_uri:
      type: string
      description: URI to the 3D model to optimize
    constraints:
      type: object
      description: Optimization constraints and settings
      properties:
        geometry:
          type: object
          description: Geometry optimization constraints
          properties:
            max_triangles:
              type: number
              minimum: 100
              maximum: 10000000
              description: Maximum triangle count
            max_vertices:
              type: number
              minimum: 100
              maximum: 5000000
              description: Maximum vertex count
            simplification_ratio:
              type: number
              minimum: 0.0
              maximum: 1.0
              description: Target simplification ratio (0.5 = 50% reduction)
            preserve_uv_seams:
              type: boolean
              description: Preserve UV seam boundaries
            preserve_hard_edges:
              type: boolean
              description: Preserve hard edges during simplification
            hard_edge_angle:
              type: number
              minimum: 0
              maximum: 90
              description: Angle threshold for hard edges in degrees
        textures:
          type: object
          description: Texture optimization constraints
          properties:
            max_resolution:
              type: string
              enum: ["256", "512", "1024", "2048", "4096"]
              description: Maximum texture resolution
            format:
              type: string
              enum: [png, jpg, webp, ktx2, basis]
              description: Output texture format
            quality:
              type: number
              minimum: 1
              maximum: 100
              description: Texture compression quality (1-100)
            compress:
              type: boolean
              description: Apply texture compression
            atlas_textures:
              type: boolean
              description: Combine textures into atlas
            atlas_max_size:
              type: number
              minimum: 256
              maximum: 8192
              description: Maximum texture atlas size
        lods:
          type: object
          description: LOD generation settings
          properties:
            generate:
              type: boolean
              description: Whether to generate LODs
            count:
              type: number
              minimum: 1
              maximum: 5
              description: Number of LOD levels
            reduction_ratios:
              type: array
              items:
                type: number
              description: Reduction ratio for each LOD level
        optimization_level:
          type: string
          enum: [minimal, balanced, aggressive, maximum]
          description: Overall optimization level preset
        target_platform:
          type: string
          enum: [mobile, web, desktop, vr, console]
          description: Target platform for optimization
        max_file_size_bytes:
          type: number
          minimum: 1024
          maximum: 1073741824
          description: Maximum output file size in bytes
    specs:
      type: object
      description: Output specifications
      properties:
        format:
          type: string
          enum: [glb, gltf, obj, fbx, usdz]
          description: Output 3D format
        embed_textures:
          type: boolean
          description: Embed textures in the model file
        draco_compression:
          type: boolean
          description: Apply Draco geometry compression
        draco_compression_level:
          type: number
          minimum: 0
          maximum: 10
          description: Draco compression level (0-10)
        meshopt_compression:
          type: boolean
          description: Apply Meshopt compression
    keep_original:
      type: boolean
      default: false
      description: Keep a copy of the original model
    provider:
      type: string
      description: Optimization provider to use

output_schema:
  type: object
  required:
    - optimized_model_uri
    - original_model_uri
    - format
    - file_size_bytes
    - geometry
    - metrics
    - processing_params
  properties:
    optimized_model_uri:
      type: string
      description: URI to the optimized 3D model
    original_model_uri:
      type: string
      description: URI to the original 3D model
    format:
      type: string
      description: Output format of the model
    file_size_bytes:
      type: number
      description: File size in bytes
    geometry:
      type: object
      required:
        - triangles
        - vertices
        - materials
      properties:
        triangles:
          type: number
        vertices:
          type: number
        materials:
          type: number
    textures:
      type: object
      properties:
        count:
          type: number
        total_size_bytes:
          type: number
        resolution:
          type: string
        format:
          type: string
        compressed:
          type: boolean
    lods:
      type: object
      properties:
        count:
          type: number
        uris:
          type: array
          items:
            type: string
        triangle_counts:
          type: array
          items:
            type: number
    metrics:
      type: object
      required:
        - original
        - optimized
        - reduction
      description: Optimization metrics comparing original and optimized
      properties:
        original:
          type: object
          properties:
            triangles:
              type: number
            vertices:
              type: number
            materials:
              type: number
            textures_size_bytes:
              type: number
            file_size_bytes:
              type: number
        optimized:
          type: object
          properties:
            triangles:
              type: number
            vertices:
              type: number
            materials:
              type: number
            textures_size_bytes:
              type: number
            file_size_bytes:
              type: number
        reduction:
          type: object
          properties:
            triangles_percent:
              type: number
            vertices_percent:
              type: number
            textures_size_percent:
              type: number
            file_size_percent:
              type: number
    processing_params:
      type: object
      required:
        - original_uri
        - optimization_level
      properties:
        original_uri:
          type: string
        optimization_level:
          type: string
        target_platform:
          type: string
        geometry_constraints:
          type: object
        texture_constraints:
          type: object

implementation:
  type: ts_function
  handler: "@skills/optimize-3d-asset/handler"

produces_artifacts:
  - artifact_type: model/3d-optimized
    description: Optimized 3D model file
  - artifact_type: model/3d-lod
    description: LOD variant files (if generated)

policy:
  max_runtime_sec: 900
  network: allowlist
  allowed_hosts:
    - "*.litellm.local"
    - "localhost:4000"
    - "api.meshy.ai"
    - "api.gltf-transform.dev"
  fs:
    read_prefixes:
      - "/tmp/skills/"
    write_prefixes:
      - "/tmp/skills/output/"

observability:
  log_level_default: info
  emit_metrics: true
