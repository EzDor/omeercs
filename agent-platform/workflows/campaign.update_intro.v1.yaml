workflow_name: campaign.update_intro
version: "1.0.0"
description: Update intro visuals (image, button segmentation, video loop) while preserving other assets

steps:
  # Step 1: Intro Image Generation
  - step_id: intro_image
    skill_id: generate_intro_image
    depends_on: []
    description: Generate new intro image with style overrides
    input_selector:
      style_guide:
        operation: merge
        inputs:
          - source: base_run
            step_id: plan
            path: data.style_guide
          - source: trigger
            path: intro_overrides.style_guide
      brand_assets:
        source: trigger
        path: brand_assets
      scene_description:
        operation: merge
        inputs:
          - source: base_run
            step_id: plan
            path: data.intro_scene
          - source: trigger
            path: intro_overrides.scene_description
    cache_policy:
      enabled: true
      scope: run_only
    retry_policy:
      max_attempts: 2
      backoff_ms: 2000

  # Step 2: Button Segmentation
  - step_id: intro_button_segmentation
    skill_id: segment_start_button
    depends_on: [intro_image]
    description: Detect and segment start button in new intro image
    input_selector:
      image_url:
        source: step_output
        step_id: intro_image
        path: outputArtifactIds[0]
      button_style:
        operation: merge
        inputs:
          - source: base_run
            step_id: plan
            path: data.ui_style
          - source: trigger
            path: intro_overrides.button_style
    cache_policy:
      enabled: true
      scope: run_only
    retry_policy:
      max_attempts: 2
      backoff_ms: 1000

  # Step 3: Intro Video Loop
  - step_id: intro_video
    skill_id: generate_intro_video_loop
    depends_on: [intro_image]
    description: Generate new looping intro video from new intro image
    input_selector:
      source_image:
        source: step_output
        step_id: intro_image
        path: outputArtifactIds[0]
      animation_style:
        operation: merge
        inputs:
          - source: base_run
            step_id: plan
            path: data.animation_style
          - source: trigger
            path: intro_overrides.animation_style
      duration_sec:
        source: base_run
        step_id: plan
        path: data.intro_duration_sec
    cache_policy:
      enabled: true
      scope: run_only
    retry_policy:
      max_attempts: 2
      backoff_ms: 3000

  # Step 4: Campaign Manifest
  - step_id: manifest
    skill_id: assemble_campaign_manifest
    depends_on: [intro_button_segmentation, intro_video]
    description: Reassemble campaign manifest with new intro visuals
    input_selector:
      campaign_id:
        source: trigger
        path: campaign_id
      intro_image:
        source: step_output
        step_id: intro_image
        path: outputArtifactIds[0]
      button_segmentation:
        source: step_output
        step_id: intro_button_segmentation
        path: data
      intro_video:
        source: step_output
        step_id: intro_video
        path: outputArtifactIds[0]
      game_bundle:
        source: base_run
        step_id: bundle_game
        path: outputArtifactIds[0]
      outcome_win:
        source: base_run
        step_id: outcome_win
        path: outputArtifactIds[0]
      outcome_lose:
        source: base_run
        step_id: outcome_lose
        path: outputArtifactIds[0]
      plan_data:
        source: base_run
        step_id: plan
        path: data
    cache_policy:
      enabled: false
      scope: run_only
    retry_policy:
      max_attempts: 1
      backoff_ms: 1000

  # Step 5: Smoke Review (Optional)
  - step_id: review_smoke
    skill_id: review_asset_quality
    depends_on: [manifest]
    description: Optional smoke test review of updated intro
    input_selector:
      manifest:
        source: step_output
        step_id: manifest
        path: data
      review_criteria:
        source: constants
        value:
          check_brand_consistency: true
          check_technical_quality: true
    cache_policy:
      enabled: false
      scope: run_only
    retry_policy:
      max_attempts: 1
      backoff_ms: 1000
