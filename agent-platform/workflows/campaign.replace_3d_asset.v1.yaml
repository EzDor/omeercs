workflow_name: campaign.replace_3d_asset
version: "1.0.0"
description: Replace a 3D asset in an existing campaign with a newly generated and optimized model

steps:
  # Step 1: Generate 3D Asset
  - step_id: generate_3d_asset
    skill_id: generate_3d_asset
    depends_on: []
    description: Generate new 3D asset from prompt and constraints
    input_selector:
      prompt:
        source: trigger
        path: asset_prompt
      constraints:
        operation: merge
        inputs:
          - source: base_run
            step_id: plan
            path: data.asset_constraints
          - source: trigger
            path: asset_constraints
      style_guide:
        source: base_run
        step_id: plan
        path: data.style_guide
      asset_slot:
        source: trigger
        path: asset_slot
    cache_policy:
      enabled: true
      scope: run_only
    retry_policy:
      max_attempts: 2
      backoff_ms: 3000

  # Step 2: Optimize 3D Asset
  - step_id: optimize_3d_asset
    skill_id: optimize_3d_asset
    depends_on: [generate_3d_asset]
    description: Optimize 3D asset for game engine (poly count, textures, LOD)
    input_selector:
      asset_url:
        source: step_output
        step_id: generate_3d_asset
        path: outputArtifactIds[0]
      optimization_params:
        operation: merge
        inputs:
          - source: base_run
            step_id: plan
            path: data.optimization_defaults
          - source: trigger
            path: optimization_params
      target_platform:
        source: base_run
        step_id: plan
        path: data.target_platform
    cache_policy:
      enabled: true
      scope: run_only
    retry_policy:
      max_attempts: 2
      backoff_ms: 2000

  # Step 3: Bundle Game with New Asset
  - step_id: bundle_game
    skill_id: bundle_game_template
    depends_on: [optimize_3d_asset]
    description: Rebundle game with replaced 3D asset
    input_selector:
      game_config:
        source: base_run
        step_id: game_config
        path: data
      audio_assets:
        source: base_run
        step_id: audio_mix
        path: outputArtifactIds
      template_id:
        source: base_run
        step_id: plan
        path: data.template_id
      replacement_assets:
        source: step_output
        step_id: optimize_3d_asset
        path: outputArtifactIds
      asset_slot:
        source: trigger
        path: asset_slot
    cache_policy:
      enabled: true
      scope: run_only
    retry_policy:
      max_attempts: 2
      backoff_ms: 2000

  # Step 4: Campaign Manifest
  - step_id: manifest
    skill_id: assemble_campaign_manifest
    depends_on: [bundle_game]
    description: Reassemble campaign manifest with new game bundle
    input_selector:
      campaign_id:
        source: trigger
        path: campaign_id
      intro_image:
        source: base_run
        step_id: intro_image
        path: outputArtifactIds[0]
      button_segmentation:
        source: base_run
        step_id: intro_button_segmentation
        path: data
      intro_video:
        source: base_run
        step_id: intro_video
        path: outputArtifactIds[0]
      game_bundle:
        source: step_output
        step_id: bundle_game
        path: outputArtifactIds[0]
      outcome_win:
        source: base_run
        step_id: outcome_win
        path: outputArtifactIds[0]
      outcome_lose:
        source: base_run
        step_id: outcome_lose
        path: outputArtifactIds[0]
      plan_data:
        source: base_run
        step_id: plan
        path: data
    cache_policy:
      enabled: false
      scope: run_only
    retry_policy:
      max_attempts: 1
      backoff_ms: 1000

  # Step 5: QA Validation
  - step_id: qa_bundle
    skill_id: validate_game_bundle
    depends_on: [bundle_game]
    description: Validate updated game bundle with new 3D asset
    input_selector:
      bundle_url:
        source: step_output
        step_id: bundle_game
        path: outputArtifactIds[0]
      validation_rules:
        source: constants
        value:
          check_audio: true
          check_textures: true
          check_3d_assets: true
          max_bundle_size_mb: 50
    cache_policy:
      enabled: false
      scope: run_only
    retry_policy:
      max_attempts: 1
      backoff_ms: 1000
